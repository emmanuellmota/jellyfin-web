define(["playbackManager","skinManager","userSettings","pluginManager","browser","connectionManager","events","datetime","dom","layoutManager","itemHelper","apphost"],function(playbackManager,skinManager,userSettings,pluginManager,browser,connectionManager,events,datetime,dom,layoutManager,itemHelper,appHost){"use strict";function updateClock(){var date=new Date,time=datetime.getDisplayTime(date).toLowerCase(),clock=document.querySelector(".headerClock");clock&&(clock.innerHTML=time)}function DefaultSkin(){function getBackButton(){return headerBackButton||(headerBackButton=document.querySelector(".headerBackButton")),headerBackButton}function onCastButtonClick(){var btn=this;require(["playerSelectionMenu"],function(playerSelectionMenu){playerSelectionMenu.show(btn)})}function updateCastIcon(){var context=document,btnCast=context.querySelector(".headerCastButton");if(btnCast){var info=playbackManager.getPlayerInfo();info&&!info.isLocalPlayer?(btnCast.querySelector("i").innerHTML="&#xE308;",btnCast.classList.add("active"),context.querySelector(".headerSelectedPlayer").innerHTML=info.deviceName||info.name):(btnCast.querySelector("i").innerHTML="&#xE307;",btnCast.classList.remove("active"),context.querySelector(".headerSelectedPlayer").innerHTML="")}}function setRemoteControlVisibility(){appHost.supports("remotecontrol")&&!layoutManager.tv?(document.querySelector(".headerCastButton").classList.remove("hide"),document.querySelector(".headerSelectedPlayer").classList.remove("hide")):(document.querySelector(".headerCastButton").classList.add("hide"),document.querySelector(".headerSelectedPlayer").classList.add("hide"))}function bindEvents(){document.querySelector(".headerBackButton").addEventListener("click",function(){Emby.Page.back()}),document.querySelector(".headerSearchButton").addEventListener("click",function(){self.search()}),document.querySelector(".headerAudioPlayerButton").addEventListener("click",function(){self.showNowPlaying()}),document.querySelector(".headerCastButton").addEventListener("click",onCastButtonClick),document.querySelector(".headerUserButton").addEventListener("click",function(){self.showUserMenu()}),events.on(connectionManager,"localusersignedin",onLocalUserSignedIn),events.on(connectionManager,"localusersignedout",onLocalUserSignedOut),document.addEventListener("viewbeforeshow",onViewBeforeShow),document.addEventListener("viewshow",onViewShow),events.on(playbackManager,"playerchange",updateCastIcon),events.on(playbackManager,"playbackstart",onPlaybackStart),events.on(playbackManager,"playbackstop",onPlaybackStop)}function unbindEvents(){events.off(connectionManager,"localusersignedin",onLocalUserSignedIn),events.off(connectionManager,"localusersignedout",onLocalUserSignedOut),document.removeEventListener("viewbeforeshow",onViewBeforeShow),document.removeEventListener("viewshow",onViewShow),events.off(playbackManager,"playerchange",updateCastIcon),events.off(playbackManager,"playbackstart",onPlaybackStart),events.off(playbackManager,"playbackstop",onPlaybackStop)}function onPlaybackStart(e,player,state){layoutManager.tv&&state.NowPlayingItem&&"Audio"===state.NowPlayingItem.MediaType?(document.querySelector(".headerAudioPlayerButton").classList.remove("hide"),state.IsFirstItem&&state.IsFullscreen&&self.showNowPlaying()):document.querySelector(".headerAudioPlayerButton").classList.add("hide")}function onPlaybackStop(e,stopInfo){"Audio"!==stopInfo.nextMediaType&&document.querySelector(".headerAudioPlayerButton").classList.add("hide")}function userImageUrl(user,apiClient,options){return options=options||{},options.type="Primary",user.PrimaryImageTag?(options.tag=user.PrimaryImageTag,apiClient.getUserImageUrl(user.Id,options)):null}function onLocalUserSignedIn(e,serverId){skinManager.setTheme(userSettings.theme()),browser.operaTv||document.querySelector(".headerSearchButton").classList.remove("hide"),refreshUserImage(connectionManager.getApiClient(serverId))}function refreshUserImage(apiClient){apiClient.getCurrentUser().then(function(user){var headerUserButton=document.querySelector(".headerUserButton");user.PrimaryImageTag?headerUserButton.innerHTML='<img src="'+userImageUrl(user,apiClient,{height:38})+'" />':headerUserButton.innerHTML='<i class="md-icon">&#xE7FD;</i>',headerUserButton.classList.remove("hide")})}function onLocalUserSignedOut(e){document.querySelector(".headerSearchButton").classList.add("hide"),document.querySelector(".headerUserButton").classList.add("hide")}function viewSupportsHeadroom(e){var path=e.detail.state.path;return-1===path.indexOf("horiz")&&-1===path.indexOf("nowplaying")&&-1===path.indexOf("startup")&&-1===path.indexOf("offline")&&-1===path.indexOf("item.html")}function viewSupportsHeaderTabs(e){var path=e.detail.state.path;return-1!==path.indexOf("tv.html")||-1!==path.indexOf("movies.html")||-1!==path.indexOf("games.html")||-1!==path.indexOf("musicvideos.html")||-1!==path.indexOf("homevideos.html")||-1!==path.indexOf("livetv.html")||-1!==path.indexOf("music.html")||-1!==path.indexOf("home/home.html")}function clearTabs(){require(["mainTabsManager"],function(mainTabsManager){mainTabsManager.setTabs(null)})}function onViewBeforeShow(e){viewSupportsHeaderTabs(e)||clearTabs(),skinHeader.dispatchEvent(new CustomEvent("clearheadroom",{cancelable:!1})),viewSupportsHeadroom(e)&&skinHeader.classList.add("skinHeader-withBackground")}function onViewShow(e){viewSupportsHeadroom(e)||skinHeader.classList.remove("skinHeader-withBackground"),skinHeader.dispatchEvent(new CustomEvent("forceclearheadroom",{cancelable:!1})),Emby.Page.canGoBack()?getBackButton().classList.remove("hide"):getBackButton().classList.add("hide")}var self=this;self.name="Default Skin",self.type="skin",self.id="defaultskin";var skinHeader,clockInterval;self.load=function(){return skinHeader=document.querySelector(".skinHeader"),layoutManager.mobile||(document.querySelector(".headerClock").classList.remove("hide"),updateClock(),clockInterval=setInterval(updateClock,5e4)),bindEvents(),setRemoteControlVisibility(),skinManager.setTheme(userSettings.theme())},self.unload=function(){return unbindEvents(),clockInterval&&(clearInterval(clockInterval),clockInterval=null),Promise.resolve()};var headerBackButton}function showBackMenuInternal(showHome){return new Promise(function(resolve,reject){require(["backMenu"],function(showBackMenu){showBackMenu({showHome:showHome}).then(resolve)})})}return DefaultSkin.prototype.getRouteUrl=function(item,options){options=options||{};var url;if("nextup"===item)return pluginManager.mapRoute(this,"list/list.html")+"?type=nextup&serverId="+options.serverId;if("recordedtv"===item)return pluginManager.mapRoute(this,"livetv/livetv.html")+"?tab=3&serverId="+options.serverId;if("livetv"===item)return"programs"===options.section?pluginManager.mapRoute(this,"livetv/livetv.html")+"?tab=0&serverId="+options.serverId:"guide"===options.section?pluginManager.mapRoute(this,"livetv/livetv.html")+"?tab=1&serverId="+options.serverId:"dvrschedule"===options.section?pluginManager.mapRoute(this,"livetv/livetv.html")+"?tab=4&serverId="+options.serverId:"onnow"===options.section?pluginManager.mapRoute(this,"list/list.html")+"?type=Program&IsAiring=true&serverId="+options.serverId:pluginManager.mapRoute(this,"livetv/livetv.html")+"?serverId="+options.serverId;if("list"===item)return url=pluginManager.mapRoute(this,"list/list.html")+"?serverId="+options.serverId+"&type="+options.itemTypes,options.isFavorite&&(url+="&IsFavorite=true"),url;var serverId=item.ServerId||options.serverId;if("Genre"===item.Type)return url=pluginManager.mapRoute(this,"list/list.html")+"?genreId="+item.Id+"&serverId="+serverId,options.parentId&&(url+="&parentId="+options.parentId),url;if("GameGenre"===item.Type)return url=pluginManager.mapRoute(this,"list/list.html")+"?gameGenreId="+item.Id+"&serverId="+serverId,options.parentId&&(url+="&parentId="+options.parentId),url;if("MusicGenre"===item.Type)return url=pluginManager.mapRoute(this,"list/list.html")+"?musicGenreId="+item.Id+"&serverId="+serverId,options.parentId&&(url+="&parentId="+options.parentId),url;if("Studio"===item.Type)return url=pluginManager.mapRoute(this,"list/list.html")+"?studioId="+item.Id+"&serverId="+serverId,options.parentId&&(url+="&parentId="+options.parentId),url;var context=options.context;if("folders"!==context&&"GameSystem"===item.Type)return url=pluginManager.mapRoute(this,"list/list.html")+"?type=Game&serverId="+serverId,url+="&parentId="+item.Id;if("folders"!==context&&!itemHelper.isLocalItem(item)){if("movies"===item.CollectionType)return url=pluginManager.mapRoute(this,"movies/movies.html")+"?serverId="+serverId+"&parentId="+item.Id,"latest"===options.section&&(url+="&tab=1"),url;if("games"===item.CollectionType)return url=pluginManager.mapRoute(this,"games/games.html")+"?serverId="+serverId+"&parentId="+item.Id;if("musicvideos"===item.CollectionType)return url=pluginManager.mapRoute(this,"musicvideos/musicvideos.html")+"?serverId="+serverId+"&parentId="+item.Id,"latest"===options.section&&(url+="&tab=1"),url;if("homevideos"===item.CollectionType)return url=pluginManager.mapRoute(this,"homevideos/homevideos.html")+"?serverId="+serverId+"&parentId="+item.Id,"latest"===options.section&&(url+="&tab=1"),url;if("tvshows"===item.CollectionType)return url=pluginManager.mapRoute(this,"tv/tv.html")+"?serverId="+serverId+"&parentId="+item.Id,"latest"===options.section&&(url+="&tab=1"),url;if("music"===item.CollectionType||"audiobooks"===item.CollectionType)return url=pluginManager.mapRoute(this,"music/music.html")+"?serverId="+serverId+"&parentId="+item.Id,options.parentId&&(url+="&parentId="+options.parentId),url}if("livetv"===item.CollectionType)return url=pluginManager.mapRoute(this,"livetv/livetv.html")+"?serverId="+serverId;var showList;return item.IsFolder&&"Series"!==item.Type&&"Season"!==item.Type&&"MusicAlbum"!==item.Type&&"MusicArtist"!==item.Type&&"Playlist"!==item.Type&&"BoxSet"!==item.Type&&(showList=!0),showList?pluginManager.mapRoute(this,"list/list.html")+"?parentId="+item.Id+"&serverId="+serverId:"SeriesTimer"===item.Type?pluginManager.mapRoute(this,"item/item.html")+"?seriesTimerId="+item.Id+"&serverId="+serverId:pluginManager.mapRoute(this,"item/item.html")+"?id="+item.Id+"&serverId="+serverId},DefaultSkin.prototype.getHeaderTemplate=function(){return pluginManager.mapPath(this,"header.html")},DefaultSkin.prototype.getDependencies=function(){var list=["css!"+pluginManager.mapPath(this,"css/style"),"flexStyles"];return browser.tv&&!browser.android?(console.log("Using system fonts with explicit sizes"),list.push("systemFontsSizedCss")):(console.log("Using default fonts"),list.push("systemFontsCss")),(browser.noFlex||browser.operaTv)&&list.push("css!"+pluginManager.mapPath(this,"css/noflex")),list.push("paper-icon-button-light"),list.push("material-icons"),list},DefaultSkin.prototype.getHomeRoute=function(){return layoutManager.tv&&"horizontal"===userSettings.get("tvhome")?"home_horiz/home.html":"home/home.html"},DefaultSkin.prototype.getTranslations=function(){var self=this;return["cs","de","el","en-GB","en-US","fr","hr","it","ko","lt-LT","nl","pl","pt-BR","pt-PT","ru","sv","tr","zh-CN"].map(function(i){return{lang:i,path:pluginManager.mapPath(self,"strings/"+i+".json")}})},DefaultSkin.prototype.getRoutes=function(){var routes=[],icons="material-icons";return routes.push({path:"home/home.html",transition:"slide",type:"home",controller:this.id+"/home/home",dependencies:["cardStyle",icons],autoFocus:!1}),routes.push({path:"home_horiz/home.html",transition:"slide",type:"home",controller:this.id+"/home_horiz/home",dependencies:["cardStyle","css!"+pluginManager.mapPath(this,"home_horiz/home.css"),icons]}),routes.push({path:"item/item.html",transition:"slide",dependencies:["css!"+pluginManager.mapPath(this,"item/item.css")],controller:this.id+"/item/item"}),routes.push({path:"list/list.html",transition:"slide",controller:this.id+"/list/list",dependencies:["cardStyle","emby-button",icons],autoFocus:!1}),routes.push({path:"music/music.html",transition:"slide",controller:this.id+"/music/music",autoFocus:!1}),routes.push({path:"movies/movies.html",transition:"slide",controller:this.id+"/movies/movies",autoFocus:!1}),routes.push({path:"games/games.html",transition:"slide",controller:this.id+"/games/games",autoFocus:!1}),routes.push({path:"homevideos/homevideos.html",transition:"slide",controller:this.id+"/homevideos/homevideos",autoFocus:!1}),routes.push({path:"musicvideos/musicvideos.html",transition:"slide",controller:this.id+"/musicvideos/musicvideos",autoFocus:!1}),routes.push({path:"livetv/livetv.html",transition:"slide",controller:this.id+"/livetv/livetv",dependencies:["css!"+pluginManager.mapPath(this,"livetv/guide.css"),icons],autoFocus:!1}),routes.push({path:"livetv/livetvitems.html",transition:"slide",controller:this.id+"/livetv/livetvitems",dependencies:[],autoFocus:!1}),routes.push({path:"tv/tv.html",transition:"slide",controller:this.id+"/tv/tv",autoFocus:!1}),routes.push({path:"search/search.html",transition:"slide",controller:this.id+"/search/search",dependencies:["css!"+pluginManager.mapPath(this,"search/search.css"),"emby-input",icons]}),routes.push({path:"nowplaying/nowplaying.html",transition:"slide",controller:this.id+"/nowplaying/nowplaying",dependencies:["css!"+pluginManager.mapPath(this,"nowplaying/nowplaying.css"),"emby-slider","paper-icon-button-light",icons],supportsThemeMedia:!0,enableMediaControl:!1}),routes.push({path:"nowplaying/playlist.html",transition:"slide",controller:this.id+"/nowplaying/playlist",dependencies:["css!"+pluginManager.mapPath(this,"item/item.css")],supportsThemeMedia:!0,enableMediaControl:!1}),routes.push({path:"nowplaying/videoosd.html",transition:"fade",controller:this.id+"/nowplaying/videoosd",dependencies:["css!"+pluginManager.mapPath(this,"nowplaying/videoosd.css"),"emby-slider","paper-icon-button-light",icons],type:"video-osd",supportsThemeMedia:!0,enableMediaControl:!1,autoFocus:!1}),routes},DefaultSkin.prototype.setTitle=function(title){var isDefault=null==title,pageTitle=document.querySelector(".pageTitle");isDefault?(pageTitle.classList.add("pageTitleWithLogo"),pageTitle.classList.add("pageTitleWithDefaultLogo")):(pageTitle.classList.remove("pageTitleWithLogo"),pageTitle.classList.remove("pageTitleWithDefaultLogo")),pageTitle.style.backgroundImage=null,pageTitle.innerHTML=title||"&nbsp;"},DefaultSkin.prototype.search=function(){Emby.Page.show(pluginManager.mapRoute(this,"search/search.html"))},DefaultSkin.prototype.showNowPlaying=function(){Emby.Page.show(pluginManager.mapRoute(this,"nowplaying/nowplaying.html"))},DefaultSkin.prototype.showUserMenu=function(){showBackMenuInternal(!0)},DefaultSkin.prototype.showBackMenu=function(){return showBackMenuInternal(!1)},DefaultSkin.prototype.getThemes=function(){var defaultTheme=browser.tizen||browser.orsay||browser.web0s||browser.operaTv||layoutManager.mobile?"dark":"blueradiance";return[{name:"Apple TV",id:"appletv"},{name:"Blue Radiance",id:"blueradiance",isDefault:"blueradiance"===defaultTheme},{name:"Dark",id:"dark",isDefault:"dark"===defaultTheme},{name:"Dark (green accent)",id:"dark-green"},{name:"Dark (red accent)",id:"dark-red"},{name:"Halloween",id:"halloween"},{name:"Light",id:"light",isDefaultServerDashboard:!0},{name:"Light (blue accent)",id:"light-blue"},{name:"Light (green accent)",id:"light-green"},{name:"Light (pink accent)",id:"light-pink"},{name:"Light (purple accent)",id:"light-purple"},{name:"Light (red accent)",id:"light-red"},{name:"Windows Media Center",id:"wmc"}]},DefaultSkin});
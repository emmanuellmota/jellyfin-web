define(["loading","scroller","./focushandler","focusManager","scrollHelper","browser","emby-button","scrollStyles"],function(loading,scroller,focusHandler,focusManager,scrollHelper,browser){"use strict";function focusViewSlider(){var selected=this.querySelector(".selected");selected?focusManager.focus(selected):focusManager.autoFocus(this)}function createHeaderScroller(view,instance,initialTabId){var userViewNames=view.querySelector(".userViewNames");userViewNames.classList.add("scrollX"),userViewNames.classList.add("smoothScrollX"),userViewNames.classList.add("focusable"),userViewNames.classList.add("focuscontainer-x"),userViewNames.focus=focusViewSlider,loading.hide(),setTimeout(function(){var initialTab=userViewNames.querySelector(".btnUserViewHeader");initialTab&&instance.setFocusDelay(view,initialTab)},0)}function parentWithClass(elem,className){for(;!elem.classList||!elem.classList.contains(className);)if(!(elem=elem.parentNode))return null;return elem}function initEvents(view,instance){var userViewNames=view.querySelector(".userViewNames");userViewNames.addEventListener("click",function(e){var elem=parentWithClass(e.target,"btnUserViewHeader");elem&&(scrollHelper.toCenter(userViewNames,elem,!0),instance.setFocusDelay(view,elem))}),userViewNames.addEventListener("focus",function(e){var elem=parentWithClass(e.target,"btnUserViewHeader");elem&&(scrollHelper.toCenter(userViewNames,elem,!0),instance.setFocusDelay(view,elem))},!0)}function selectUserView(page,id,self){var btn=page.querySelector(".btnUserViewHeader[data-id='"+id+"']");self.bodyScroller.slideTo(0,!0);var contentScrollSlider=page.querySelector(".contentScrollSlider");contentScrollSlider.innerHTML="";var promise=self.loadViewContent.call(self,page,id,btn.getAttribute("data-type"));promise&&browser.animate&&promise.then(function(){fadeInRight(contentScrollSlider)})}function fadeInRight(elem){var keyframes=[{opacity:"0",transform:"translate3d(1%, 0, 0)",offset:0},{opacity:"1",transform:"none",offset:1}],timing={duration:300,iterations:1};elem.animate(keyframes,timing)}function tabbedPage(page,pageOptions){function createHorizontalScroller(view){var scrollFrame=view.querySelector(".itemScrollFrame"),options={horizontal:1,itemNav:0,mouseDragging:1,touchDragging:1,slidee:view.querySelector(".contentScrollSlider"),itemSelector:".card",smart:!0,releaseSwing:!0,scrollBy:200,speed:270,immediateSpeed:pageOptions.immediateSpeed,elasticBounds:1,dragHandle:1,dynamicHandle:1,clickBar:1,scrollWidth:5e5};self.bodyScroller=new scroller(scrollFrame,options),self.bodyScroller.init(),initFocusHandler(view,self.bodyScroller)}function initFocusHandler(view){if(pageOptions.handleFocus){var scrollSlider=view.querySelector(".contentScrollSlider");self.focusHandler=new focusHandler({parent:scrollSlider,selectedItemInfoElement:selectedItemInfoElement,selectedIndexElement:selectedIndexElement,animateFocus:pageOptions.animateFocus,scroller:self.bodyScroller,enableBackdrops:!0})}}var self=this;pageOptions=pageOptions||{},page.querySelector(".contentScrollSlider").classList.add("focuscontainer-x");var selectedItemInfoElement=page.querySelector(".selectedItemInfo"),selectedIndexElement=page.querySelector(".selectedIndex");self.renderTabs=function(tabs){page.querySelector(".userViewNames").innerHTML=tabs.map(function(i){return'<button is="emby-button" class="flat btnUserViewHeader button-flat" data-id="'+i.Id+'" data-type="'+(i.CollectionType||"")+'"><span class="userViewButtonText">'+i.Name+"</span></button>"}).join(""),createHeaderScroller(page,self),createHorizontalScroller(page),initEvents(page,self)};var focusTimeout,focusDelay=0;self.setFocusDelay=function(view,elem,immediate){var viewId=elem.getAttribute("data-id"),btn=view.querySelector(".btnUserViewHeader.selected");if(!btn||viewId!==btn.getAttribute("data-id")){elem!==btn&&(btn&&btn.classList.remove("selected"),elem.classList.add("selected")),focusTimeout&&clearTimeout(focusTimeout);var onTimeout=function(){selectUserView(view,viewId,self)};immediate?onTimeout():focusTimeout=setTimeout(onTimeout,focusDelay),focusDelay=700}},self.destroy=function(){self.focusHandler&&(self.focusHandler.destroy(),self.focusHandler=null),self.bodyScroller&&(self.bodyScroller.destroy(),self.bodyScroller=null)}}return tabbedPage});
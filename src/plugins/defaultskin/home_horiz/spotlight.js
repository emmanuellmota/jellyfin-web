define(["visibleinviewport","itemShortcuts","browser","connectionManager"],function(visibleinviewport,itemShortcuts,browser,connectionManager){"use strict";function backdropImageUrl(item,options){return options=options||{},options.type=options.type||"Backdrop",options.maxWidth||options.width||options.maxHeight||options.height||(options.quality=100),item.BackdropImageTags&&item.BackdropImageTags.length?(options.tag=item.BackdropImageTags[0],connectionManager.getApiClient(item.ServerId).getScaledImageUrl(item.Id,options)):null}function loadItemIntoSpotlight(card,item,width){if(item.BackdropImageTags&&item.BackdropImageTags.length){document.activeElement===card&&card.dispatchEvent(new CustomEvent("focus"));var imgUrl=backdropImageUrl(item,{maxWidth:width}),cardImageContainer=card.querySelector(".cardImage"),newCardImageContainer=document.createElement("div");newCardImageContainer.className=cardImageContainer.className,newCardImageContainer.style.backgroundImage="url('"+imgUrl+"')",card.querySelector(".cardText").innerHTML=item.Name,card.setAttribute("data-id",item.Id),card.setAttribute("data-serverid",item.ServerId),card.setAttribute("data-type",item.Type),card.setAttribute("data-isfolder",item.IsFolder.toString()),card.setAttribute("data-action","link"),card.classList.add("itemAction"),cardImageContainer.parentNode.appendChild(newCardImageContainer);var onAnimationFinished=function(){var parentNode=cardImageContainer.parentNode;parentNode&&parentNode.removeChild(cardImageContainer)};if(browser.animate){var keyframes=[{opacity:"0",offset:0},{opacity:"1",offset:1}],timing={duration:900,iterations:1};newCardImageContainer.animate(keyframes,timing).onfinish=onAnimationFinished}else onAnimationFinished()}}function spotlight(card,items,width){var self=this;itemShortcuts.on(card),self.items=items,self.card=card,self.width=width,self.start()}return spotlight.prototype.start=function(){var self=this,items=self.items,card=self.card,width=self.width;if(items.length&&(loadItemIntoSpotlight(card,items[0],width),1!==items.length&&!browser.slow)){self.index=1;var intervalMs=browser.animate?1e4:3e4;self.interval=setInterval(self.onInterval.bind(self),intervalMs)}},spotlight.prototype.onInterval=function(){var self=this,items=self.items,card=self.card,width=self.width;if(!document.body.contains(card))return void clearInterval(self.interval);visibleinviewport(card,!1,0)&&(self.index>=items.length&&(self.index=0),loadItemIntoSpotlight(card,items[self.index],width),self.index++)},spotlight.prototype.destroy=function(){var self=this;itemShortcuts.off(self.card),self.interval&&clearInterval(self.interval),self.interval=null,self.items=null,self.card=null},spotlight});